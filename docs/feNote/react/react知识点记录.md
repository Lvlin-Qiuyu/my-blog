# React çŸ¥è¯†ç‚¹è®°å½•



é€šè¿‡ react react-domï¼Œåœ¨é¡µé¢å®šä¹‰ä¸€ä¸ª id é¡¹ï¼Œä½¿ç”¨ createRoot æ–¹æ³•è¿›è¡Œå±€éƒ¨æ¸²æŸ“ã€‚
 è¯¥æ–¹å¼å¯ä»¥æ¸è¿›å¼åœ°ä½¿ç”¨ reactã€‚

 eslint æ’ä»¶ï¼šeslint-config-react-appï¼Œeslint-config-prettier
 [react ç›¸å…³çš„ vscode æ’ä»¶](https://react.docschina.org/learn/editor-setup)
 vue ç”¨ volar æ ¼å¼åŒ–ï¼Œreact ç”¨ prettier æ ¼å¼åŒ–ï¼Œå†å®‰è£…ä¸€ä¸ªFormatting Toggleï¼Œç”¨äºå¼€å¯å’Œå…³é—­ prettierã€‚

 https://react.docschina.org/learn/typescript dom-to-image  

 https://juejin.cn/post/7205753233599578170 vscode æ’ä»¶é…ç½®ï¼Œå­—ä½“ç”¨ä»€ä¹ˆï¼Œä¸‰ç­‰å·çš„è¿™ä¸ªå¾ˆèˆ’æœ  


 ä»Šå¤©äº†è§£äº† prettier æ˜¯ä¸€ä¸ªç”¨æ¥è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç çš„å·¥å…·ï¼Œä½†æ˜¯è·Ÿ eslint ä¸ä¸€æ ·ï¼Œeslint æ˜¯ç”¨äºæ£€æŸ¥çš„å·¥å…·ã€‚ä¸ºä»€ä¹ˆ eslint ä¸åŒ…æ‹¬è‡ªåŠ¨æ ¼å¼åŒ–çš„å†…å®¹å‘¢ã€‚

 Prettier ESLint è¿™ä¸ªæ’ä»¶å¥½åƒè§£å†³äº†ğŸ‘†è¿™ä¸ªé—®é¢˜ï¼Œå®é™…å¥½åƒæ²¡æœ‰ã€‚
 .editorconfig æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„é…ç½®æ–‡ä»¶ï¼Œç»Ÿä¸€å¾ˆå¤šä¸œè¥¿ï¼Œåœ¨è¿™é‡Œé…ç½®å•å¼•å·ã€‚

 vsc-nvm æ’ä»¶ï¼Œé€šè¿‡é…ç½® .nvmrc æ–‡ä»¶ï¼Œæ‰“å¼€é¡¹ç›®è‡ªåŠ¨ä½¿ç”¨ nvm è¿›è¡Œ node ç‰ˆæœ¬çš„åˆ‡æ¢ã€‚

 è§£å†³ eslint ä¸ prettier å†²çªçš„åŠæ³•ï¼šhttps://juejin.cn/post/7012160233061482532

 æä¸€ä¸ªä»£ç æ ¼å¼åŒ–å’Œè´¨é‡æ£€æŸ¥çš„ç»ˆæé…ç½®ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬æäº¤ã€‚

---

 react è·Ÿ react-dom æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ
 é…ç½® react çš„ tsï¼š
 npm install @types/react @types/react-dom

---

```react
 <label>
     <input type="checkbox" value={inStockOnly} onChange={(e)=>onInStockOnlyChange(e.target.value)} />
     {' '}
     Only show products in stock
   </label>
```

å¤šä¸ªç©ºæ ¼çš„å†™æ³•ã€‚

---

react èƒ½å¤Ÿé€šè¿‡ useContextï¼Œå®ç° vue ä¸­ provider ç›¸å…³çš„æŠ€æœ¯ï¼Œè¿›è¡Œç»„ä»¶æ ‘çš„æ•°æ®ä¼ é€’ã€‚
 useMemoï¼Œç±»ä¼¼äº vue çš„ Computedï¼Œä¸€ç§è®°å¿†åŒ–è®¡ç®—å­˜å‚¨æ•°æ®çš„æ–¹å¼ã€‚

 [react ts é€ŸæŸ¥è¡¨](https://react-typescript-cheatsheet.netlify.app/)
 [JSX å¯¹åº”å±æ€§é€ŸæŸ¥è¡¨](https://react.docschina.org/reference/react-dom/components/common)
 [html to jsx è½¬åŒ–å™¨](https://transform.tools/html-to-jsx)

---

react ä½¿ç”¨ props è¿›è¡Œæ’æ§½ä¼ é€’ 

```react
 <Card>
    <Avatar />
</Card>  

function Card({ children }) {   
    return (     
        <div className="card">       
            {children}     
        </div>   
    ); 
} 
```

props ä¸å¯æ”¹å˜ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œè®¾ç½® stateã€‚ å¯ä»¥ä½¿ç”¨ <Avatar {...props} /> JSX å±•å¼€è¯­æ³•è½¬å‘æ‰€æœ‰ propsï¼Œä½†ä¸è¦è¿‡åº¦ä½¿ç”¨å®ƒï¼

Fragment è¯­æ³•çš„ç®€å†™å½¢å¼ <> </> æ— æ³•æ¥å— key å€¼ï¼Œæ‰€ä»¥ä½ åªèƒ½è¦ä¹ˆæŠŠç”Ÿæˆçš„èŠ‚ç‚¹ç”¨ä¸€ä¸ª \<div> æ ‡ç­¾åŒ…è£¹èµ·æ¥ï¼Œè¦ä¹ˆä½¿ç”¨é•¿ä¸€ç‚¹ä½†æ›´æ˜ç¡®çš„ \<Fragment> å†™æ³•ï¼š 

``` react
import { Fragment } from 'react';

// ...

const listItems = people.map(person =>
  <Fragment key={person.id}>
    <h1>{person.name}</h1>
    <p>{person.bio}</p>
  </Fragment>
);
```

ç»„ä»¶ä¸ä¼šæŠŠ key å½“ä½œ props çš„ä¸€éƒ¨åˆ†ã€‚  



åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼ˆå°¤å…¶æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸–ç•Œä¸­ï¼‰ï¼Œçº¯å‡½æ•° é€šå¸¸å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š 

- åªè´Ÿè´£è‡ªå·±çš„ä»»åŠ¡ã€‚å®ƒä¸ä¼šæ›´æ”¹åœ¨è¯¥å‡½æ•°è°ƒç”¨å‰å°±å·²å­˜åœ¨çš„å¯¹è±¡æˆ–å˜é‡ã€‚ 

- è¾“å…¥ç›¸åŒï¼Œåˆ™è¾“å‡ºç›¸åŒã€‚ç»™å®šç›¸åŒçš„è¾“å…¥ï¼Œçº¯å‡½æ•°åº”æ€»æ˜¯è¿”å›ç›¸åŒçš„ç»“æœã€‚

  

React æä¾›äº† â€œä¸¥æ ¼æ¨¡å¼â€ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å¼€å‘æ—¶ï¼Œå®ƒå°†ä¼šè°ƒç”¨æ¯ä¸ªç»„ä»¶å‡½æ•°ä¸¤æ¬¡ã€‚é€šè¿‡é‡å¤è°ƒç”¨ç»„ä»¶å‡½æ•°ï¼Œä¸¥æ ¼æ¨¡å¼æœ‰åŠ©äºæ‰¾åˆ°è¿åè¿™äº›è§„åˆ™çš„ç»„ä»¶ã€‚  

åœ¨ React ä¸­ï¼Œå‰¯ä½œç”¨é€šå¸¸å±äº äº‹ä»¶å¤„ç†ç¨‹åºã€‚äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯ React åœ¨ä½ æ‰§è¡ŒæŸäº›æ“ä½œï¼ˆå¦‚å•å‡»æŒ‰é’®ï¼‰æ—¶è¿è¡Œçš„å‡½æ•°ã€‚**å³ä½¿äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯åœ¨ä½ çš„ç»„ä»¶ å†…éƒ¨ å®šä¹‰çš„ï¼Œå®ƒä»¬ä¹Ÿä¸ä¼šåœ¨æ¸²æŸ“æœŸé—´è¿è¡Œï¼** å› æ­¤äº‹ä»¶å¤„ç†ç¨‹åºæ— éœ€æ˜¯çº¯å‡½æ•°ã€‚

---

ä¸€ä¸ªçº¯å‡½æ•°ç»„ä»¶ï¼šåªè´Ÿè´£è‡ªå·±çš„ä»»åŠ¡ï¼ŒåŒæ ·çš„è¾“å…¥ä¼šæœ‰åŒæ ·çš„è¾“å‡ºã€‚



 æ¸²æŸ“éšæ—¶å‘ç”Ÿï¼Œç»„ä»¶ä¹‹é—´çš„æ¸²æŸ“ä¸åº”è¯¥äº’ç›¸ä¾èµ–ã€‚



 ç”¨äºç»„ä»¶æ¸²æŸ“çš„è¾“å…¥ä¸åº”è¯¥è¢«æ”¹å˜ï¼ŒåŒ…æ‹¬ propsã€stateã€contextï¼Œåªé€šè¿‡ ã€Œè®¾ç½®stateã€æ¥æ›´æ–°æ•°æ®ã€‚



 useEffect ç”¨ä½œæœ€åçš„æ‰‹æ®µã€‚



 å°½é‡é¿å… dom æ“ä½œç­‰ä¼šå½±å“å…¨å±€æˆ–è€…å½±å“å…¶å®ƒç»„ä»¶çš„æ“ä½œã€‚



 ä¼˜å…ˆç¼–å†™é™æ€é¡µé¢ï¼Œç„¶åå†æ·»åŠ äº¤äº’ã€‚



 éšæ—¶é—´å˜åŒ–çš„æ•°æ®è¢«ç§°ä¸ºçŠ¶æ€ï¼ˆstateï¼‰ã€‚



 è‡ªå®šä¹‰äº‹ä»¶åç§°é€šå¸¸ä»¥ handle å¼€å¤´ï¼Œåè·Ÿäº‹ä»¶åç§°ï¼Œå¦‚ handleClickã€‚äº‹ä»¶å¤„ç†å‡½æ•° props åº”è¯¥ä»¥ on å¼€å¤´ï¼Œåè·Ÿä¸€ä¸ªå¤§å†™å­—æ¯ã€‚



 ä¼ é€’ç»™äº‹ä»¶å¤„ç†å‡½æ•°çš„å‡½æ•°åº”ç›´æ¥ä¼ é€’ï¼Œè€Œéè°ƒç”¨ã€‚å¦‚æœéœ€è¦ä¼ å‚ç­‰ï¼Œç”¨ä¸€ä¸ªç®­å¤´å‡½æ•°è¿›è¡ŒåŒ…è£¹ã€‚å› ä¸ºåœ¨ JSX { å’Œ } ä¹‹é—´çš„ JavaScript ä¼šç«‹å³æ‰§è¡Œã€‚



 äº‹ä»¶å¤„ç†å‡½æ•°æ¥æ”¶ä¸€ä¸ª äº‹ä»¶å¯¹è±¡ ä½œä¸ºå”¯ä¸€çš„å‚æ•°ã€‚äº‹ä»¶é»˜è®¤æ˜¯å†’æ³¡ä¼ æ’­ï¼Œå¦‚æœä½ æƒ³é˜»æ­¢ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾çˆ¶ç»„ä»¶ï¼Œä½¿ç”¨ e.stopPropagation() ã€‚



 æ•è·äº‹ä»¶ï¼Œ åœ¨äº‹ä»¶ååé¢+Captureï¼Œå¦‚ onClick äº‹ä»¶å¯¹åº”çš„æ•è·äº‹ä»¶åæ˜¯ onClickCaptureã€‚



 e.preventDefault() é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚



 ä¸æ¸²æŸ“å‡½æ•°ä¸åŒï¼Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸éœ€è¦æ˜¯ çº¯å‡½æ•°ï¼Œ  æ˜¯æ‰§è¡Œå‰¯ä½œç”¨çš„æœ€ä½³ä½ç½®ã€‚



 å±€éƒ¨å˜é‡æ— æ³•åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­æŒä¹…ä¿å­˜ã€‚æ›´æ”¹å±€éƒ¨å˜é‡ä¸ä¼šè§¦å‘æ¸²æŸ“ã€‚ 



 Hook æ˜¯ç‰¹æ®Šçš„å‡½æ•°ï¼Œåªåœ¨ React æ¸²æŸ“æ—¶æœ‰æ•ˆã€‚Hook åªèƒ½åœ¨ç»„ä»¶å‡½æ•°çš„é¡¶å±‚è°ƒç”¨ã€‚



 ä»€ä¹ˆæ—¶å€™ state åº”è¯¥ç”¨å¯¹è±¡ã€‚å¯¹è±¡çš„æŸä¸ªå±æ€§å˜åŒ–äº†ä¼šè§¦å‘ react é‡æ¸²æŸ“å—ï¼Ÿåº”è¯¥è°ƒç”¨äº† setState å°±ä¼šé‡æ¸²æŸ“ã€‚



 æ¯ä¸ªç»„ä»¶çš„ useState ç»´æŠ¤äº†ä¸€ä¸ªæ•°ç»„ã€‚



 useState ç»´æŠ¤æ•°ç»„çš„ä¸€ä¸ªå¿ƒæ™ºæ¨¡å‹ï¼šhttps://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236eï¼Œhttps://react.docschina.org/learn/state-a-components-memory



 State ä¸ä¾èµ–äºç‰¹å®šçš„å‡½æ•°è°ƒç”¨æˆ–åœ¨ä»£ç ä¸­çš„ä½ç½®ï¼Œå®ƒçš„ä½œç”¨åŸŸâ€œåªé™äºâ€å±å¹•ä¸Šçš„æŸå—ç‰¹å®šåŒºåŸŸã€‚state å®Œå…¨ç§æœ‰äºå£°æ˜å®ƒçš„ç»„ä»¶ã€‚



 å¯¼è‡´ç»„ä»¶çš„æ¸²æŸ“ï¼š1ã€ç»„ä»¶çš„åˆæ¬¡æ¸²æŸ“ï¼›2ã€ç»„ä»¶ï¼ˆæˆ–çˆ¶ç»„ä»¶ï¼‰çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ã€‚



 æ¸²æŸ“æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œæ›´æ–°åçš„ç»„ä»¶è¿”å›å¦å¤–çš„ç»„ä»¶ï¼Œç»§ç»­æ¸²æŸ“è¯¥ç»„ä»¶ã€‚



 ä¸è¦è¿‡æ—©è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚



 å¯¹äºåˆæ¬¡æ¸²æŸ“ï¼Œ React ä¼šä½¿ç”¨ appendChild() DOM API å°†å…¶åˆ›å»ºçš„æ‰€æœ‰ DOM èŠ‚ç‚¹æ”¾åœ¨å±å¹•ä¸Šã€‚å¯¹äºé‡æ¸²æŸ“ï¼Œ React å°†åº”ç”¨æœ€å°‘çš„å¿…è¦æ“ä½œï¼ˆåœ¨æ¸²æŸ“æ—¶è®¡ç®—ï¼ï¼‰ï¼Œä»¥ä½¿å¾— DOM ä¸æœ€æ–°çš„æ¸²æŸ“è¾“å‡ºç›¸äº’åŒ¹é…ã€‚



 ä¿®æ”¹ state çš„æ—¶å€™ï¼Œä¸æ˜¯å³æ—¶ç”Ÿæ•ˆçš„ï¼Œä¾‹å¦‚ä¸‹åˆ—ä»£ç ï¼Œnumber ä¸€å¼€å§‹ä¸º0ï¼Œé‚£ä¹ˆç‚¹å‡»æŒ‰é’®å¾—åˆ°çš„æ˜¯1ã€‚

```react
<button onClick={() => {
  setNumber(number + 1);
  setNumber(number + 1);
  setNumber(number + 1);
}}>+3</button>
```

å¼•å…¥äº†å¿«ç…§çš„æ¦‚å¿µï¼Œå½“ä¸‹ä½¿ç”¨çš„ state æ˜¯ä¸€ä¸ªå¿«ç…§ï¼Œä¸å› ä¸º setState è€Œå˜æ›´ã€‚



 ä¸€ä¸ª state å˜é‡çš„å€¼æ°¸è¿œä¸ä¼šåœ¨ä¸€æ¬¡æ¸²æŸ“çš„å†…éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œ å³ä½¿å…¶äº‹ä»¶å¤„ç†å‡½æ•°çš„ä»£ç æ˜¯å¼‚æ­¥çš„ã€‚åœ¨ é‚£æ¬¡æ¸²æŸ“çš„ onClick å†…éƒ¨ï¼Œnumber çš„å€¼å³ä½¿åœ¨è°ƒç”¨ setNumber(number + 5) ä¹‹åä¹Ÿè¿˜æ˜¯ 0ã€‚å®ƒçš„å€¼åœ¨ React é€šè¿‡è°ƒç”¨ä½ çš„ç»„ä»¶â€œè·å– UI çš„å¿«ç…§â€æ—¶å°±è¢«â€œå›ºå®šâ€äº†ã€‚



 React ä¼šä½¿ state çš„å€¼å§‹ç»ˆâ€å›ºå®šâ€œåœ¨ä¸€æ¬¡æ¸²æŸ“çš„å„ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨ã€‚ ä½ æ— éœ€æ‹…å¿ƒä»£ç è¿è¡Œæ—¶ state æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚



 å¦‚æœéœ€è¦åœ¨æ¸²æŸ“ä¹‹å‰è¯»å–æœ€æ–°çš„ state å€¼ï¼Œ(ç±»ä¼¼äº vue çš„ nextTick?)ï¼Œä½¿ç”¨çŠ¶æ€æ›´æ–°å‡½æ•°ã€‚



 å‘ç°ç°è±¡ï¼šå¼¹çª—é˜»å¡äº†æ¸²æŸ“ã€‚



 ä½†æ˜¯å¦‚æœä½ æƒ³åœ¨ä¸‹æ¬¡æ¸²æŸ“ä¹‹å‰å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ª stateï¼Œä½ å¯ä»¥åƒ setNumber(n => n + 1) è¿™æ ·ä¼ å…¥ä¸€ä¸ªæ ¹æ®é˜Ÿåˆ—ä¸­çš„å‰ä¸€ä¸ª state è®¡ç®—ä¸‹ä¸€ä¸ª state çš„ å‡½æ•°ï¼Œè€Œä¸æ˜¯åƒ setNumber(number + 1) è¿™æ ·ä¼ å…¥ ä¸‹ä¸€ä¸ª state å€¼ã€‚



 äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæˆåï¼ŒReact å°†è§¦å‘é‡æ–°æ¸²æŸ“ã€‚åœ¨é‡æ–°æ¸²æŸ“æœŸé—´ï¼ŒReact å°†å¤„ç†é˜Ÿåˆ—ã€‚æ›´æ–°å‡½æ•°ä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œï¼Œå› æ­¤ æ›´æ–°å‡½æ•°å¿…é¡»æ˜¯ çº¯å‡½æ•° å¹¶ä¸”åª è¿”å› ç»“æœã€‚



 é€šè¿‡ç›¸åº” state å˜é‡çš„ç¬¬ä¸€ä¸ªå­—æ¯æ¥å‘½åæ›´æ–°å‡½æ•°çš„å‚æ•°ï¼š

```react
setEnabled(e => !e);
setLastName(ln => ln.reverse());
setFriendCount(fc => fc * 2);
```



ä¸åº”è¯¥ç›´æ¥æ”¹å˜ä½ åœ¨ React çŠ¶æ€ä¸­æŒæœ‰çš„å¯¹è±¡å’Œæ•°ç»„ã€‚ç›¸åï¼Œå½“ä½ æƒ³æ›´æ–°ä¸€ä¸ªå¯¹è±¡å’Œæ•°ç»„æ—¶ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆæˆ–å¤åˆ¶ç°æœ‰çš„å¯¹è±¡ï¼‰ï¼Œç„¶åç”¨è¿™ä¸ªå‰¯æœ¬æ¥æ›´æ–°çŠ¶æ€ã€‚

```react
setPerson({
  ...person,
  artwork: {
    ...person.artwork,
    city: e.target.value
  }
});
```

å·æ‡’å¯ä»¥ä½¿ç”¨ [use-immer](https://github.com/immerjs/use-immer/blob/master/src/index.ts)è¿™æ ·çš„æ–¹æ³•ï¼Œçœ‹ä¸‹æºç ï¼Œå®ç°åŸç†æ˜¯ï¼šï¼ˆå¾…è¡¥å…….......ï¼‰

---

use-immerï¼Œä¼ å…¥å‡½æ•°ï¼Œdraft å°±æ˜¯æ·±æ‹·è´åçš„ä¸€ä¸ªå¯¹è±¡ï¼Œçœ‹ä¸‹æºç å®ç°ã€‚

 ç®€æ˜“ç‰ˆå®ç°ï¼š

```js
function useImmer(initialData) {
    const [data, setData] = useState(initialData);

    function setDataImmer(fn) {
        const draft = JSON.parse(JSON.stringify(data)); // è¿™é‡Œåº”è¯¥æ˜¯æ·±æ‹·è´ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„
        fn(draft);
        setData(draft);
    }

    return [data, setDataImmer];
}
```



ç±»ä¼¼è¿™æ ·çš„é¡µé¢é€šå¸¸è¢«ç§°ä½œâ€œliving styleguideâ€æˆ–â€œstorybookâ€ã€‚å°†æ‰€æœ‰çŠ¶æ€éƒ½åˆ—å‡ºæ¥çš„æƒ…å†µã€‚



 ä½ æœ€åˆçš„æƒ³æ³•æˆ–è®¸ä¸æ˜¯æœ€å¥½çš„ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œé‡æ„ state ä¹Ÿæ˜¯æ­¥éª¤ä¸­çš„ä¸€éƒ¨åˆ†ï¼

 ä½¿ç”¨ state åº”è¯¥å°½é‡ç²¾ç®€ï¼Œä¸è¦äº’ç›¸å½±å“ã€‚

- åˆå¹¶å…³è”çš„ state
- é¿å…äº’ç›¸çŸ›ç›¾çš„ state
- é¿å…å†—ä½™çš„ stateï¼šä¸è¦å°†props ä½œä¸º state åˆå§‹å€¼ï¼Œåªä¼šåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™åˆå§‹åŒ–ä¸€æ¬¡ã€‚
- é¿å…æ·±åº¦åµŒå¥—çš„ stateï¼Œå°†æ•°æ®æ‰å¹³åŒ–ã€‚ç”¨idè¿›è¡Œæ ‡è¯†



å°†ç›¸å…³çŠ¶æ€ä»è¿™ä¸¤ä¸ªç»„ä»¶ä¸Šç§»é™¤ï¼Œå¹¶æŠŠçŠ¶æ€ç§»åˆ°æœ€è¿‘çš„çˆ¶çº§ç»„ä»¶ï¼Œç„¶åé€šè¿‡ props å°†çŠ¶æ€ä¼ é€’ç»™è¿™ä¸¤ä¸ªç»„ä»¶ã€‚è¿™è¢«ç§°ä¸ºâ€œçŠ¶æ€æå‡â€ï¼Œå®ç°ç»„ä»¶é—´çŠ¶æ€å…±äº«ã€‚



é€šå¸¸æˆ‘ä»¬æŠŠåŒ…å«â€œä¸å—æ§åˆ¶â€çŠ¶æ€çš„ç»„ä»¶ç§°ä¸ºâ€œéå—æ§ç»„ä»¶â€ã€‚çˆ¶ç»„ä»¶æ— æ³•æ§åˆ¶é¢æ¿çš„æ¿€æ´»çŠ¶æ€ã€‚

å½“ç»„ä»¶ä¸­çš„é‡è¦ä¿¡æ¯æ˜¯ç”± props è€Œä¸æ˜¯å…¶è‡ªèº«çŠ¶æ€é©±åŠ¨æ—¶ï¼Œå°±å¯ä»¥è®¤ä¸ºè¯¥ç»„ä»¶æ˜¯â€œå—æ§ç»„ä»¶â€ã€‚è¿™å°±å…è®¸çˆ¶ç»„ä»¶å®Œå…¨æŒ‡å®šå…¶è¡Œä¸ºã€‚

å¯¹äºæ¯ä¸ªç‹¬ç‰¹çš„çŠ¶æ€ï¼Œéƒ½åº”è¯¥å­˜åœ¨ä¸”åªå­˜åœ¨äºä¸€ä¸ªæŒ‡å®šçš„ç»„ä»¶ä¸­ä½œä¸º stateã€‚è¿™ä¸€åŸåˆ™ä¹Ÿè¢«ç§°ä¸ºæ‹¥æœ‰ â€œå¯ä¿¡å•ä¸€æ•°æ®æºâ€ã€‚



state æœ‰æ—¶å€™éœ€è¦é‡ç½®ï¼ŒReact å…è®¸ä½ è¦†ç›–é»˜è®¤è¡Œä¸ºï¼Œå¯é€šè¿‡å‘ç»„ä»¶ä¼ é€’ä¸€ä¸ªå”¯ä¸€ keyï¼ˆå¦‚ \<Chat key={email}/> æ¥ å¼ºåˆ¶ é‡ç½®å…¶çŠ¶æ€ã€‚

 React ä¸çŸ¥é“ä½ çš„å‡½æ•°é‡Œæ˜¯å¦‚ä½•è¿›è¡Œæ¡ä»¶åˆ¤æ–­çš„ï¼Œå®ƒåªä¼šâ€œçœ‹åˆ°â€ä½ è¿”å›çš„æ ‘ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒApp ç»„ä»¶éƒ½ä¼šè¿”å›ä¸€ä¸ªåŒ…è£¹ç€ \<Counter /> ä½œä¸ºç¬¬ä¸€ä¸ªå­ç»„ä»¶çš„ divã€‚è¿™å°±æ˜¯ React è®¤ä¸ºå®ƒä»¬æ˜¯ åŒä¸€ä¸ª \<Counter /> çš„åŸå› ã€‚

 ç›¸åŒä½ç½®çš„ä¸åŒç»„ä»¶ä¼šä½¿ state é‡ç½®ï¼›keyä¸åŒä¼šé‡ç½®ã€‚æ¸²æŸ“åœ¨ä¸åŒçš„ä½ç½®ä¹Ÿä¼šé‡ç½®ã€‚
 æ¶‰åŠåˆ° diff ç®—æ³•äº†ã€‚

 ä¸åŒä½ç½®çš„å†™æ³•ï¼š

```react
      {isPlayerA &&
        <Counter person="Taylor" />
      }
      {!isPlayerA &&
        <Counter person="Sarah" />
      }
```

æ°¸è¿œè¦å°†ç»„ä»¶å®šä¹‰åœ¨æœ€ä¸Šå±‚å¹¶ä¸”ä¸è¦æŠŠå®ƒä»¬çš„å®šä¹‰åµŒå¥—èµ·æ¥ã€‚å¦åˆ™ä¼šåœ¨æ¸²æŸ“çš„æ—¶å€™è¢«é‡ç½®ã€‚

---

å›¾ç‰‡çš„æ—¶å€™ä¼šå‡ºç°ä¸‹ä¸€å¼ å›¾ç‰‡æ²¡æœ‰åŠ è½½å‡ºæ¥ï¼Œä¸Šä¸€å¼ å›¾ç‰‡ç»§ç»­å±•ç¤ºçš„æƒ…å†µï¼Œéœ€è¦åŠ  key å€¼è¿›è¡Œé¿å…ã€‚
 [å¯¹ state è¿›è¡Œä¿ç•™å’Œé‡ç½®_æŒ‘æˆ˜4](https://react.docschina.org/learn/preserving-and-resetting-state)

 reducerï¼Œä¸€ç§å°†å¯¹çŠ¶æ€æ‰€æœ‰çš„å˜æ›´éƒ½è¿›è¡Œå°è£…çš„æ–¹å¼ï¼Œ

```react
[tasks, dispatch] = useReducer(tasksReducer, initialTashs);

function tasksReducer(tasks, action) {
  switch (action.type) {
    case 'added': {
      return [
        ...tasks,
        {
          id: action.id,
          text: action.text,
          done: false,
        },
      ];
    }
    case 'changed': {
      return tasks.map((t) => {
        if (t.id === action.task.id) {
          return action.task;
        } else {
          return t;
        }
      });
    }
    case 'deleted': {
      return tasks.filter((t) => t.id !== action.id);
    }
    default: {
      throw Error('æœªçŸ¥ action: ' + action.type);
    }
  }
}
```

å»ºè®®ä½¿ç”¨ switchï¼Œå°†æ¯ä¸ª case å—åŒ…è£…åˆ° { å’Œ } èŠ±æ‹¬å·ä¸­ï¼Œè¿™æ ·åœ¨ä¸åŒ case ä¸­å£°æ˜çš„å˜é‡å°±ä¸ä¼šäº’ç›¸å†²çªã€‚æ­¤å¤–ï¼Œcase é€šå¸¸åº”è¯¥ä»¥ return ç»“å°¾ã€‚



 åˆ†ç¦»å…³æ³¨ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å®¹æ˜“åœ°ç†è§£ç»„ä»¶é€»è¾‘ã€‚



 ä¸¤æ¬¡ dispatch çš„è®¡ç®—å€¼ï¼Œä¼šè¿›è¡Œç´¯è®¡ã€‚ä¸åƒ setState ä¸€æ ·ï¼Œå–åˆ°çš„æ˜¯å½“å‰çš„ stateï¼Œå–åˆ°çš„éƒ½æ˜¯æœ€æ–°çš„ state



 ä¸è¦æŠŠä¸šåŠ¡é€»è¾‘å†™åœ¨ reducer é‡Œé¢ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹å¼€å‘ç¯å¢ƒä¼šè¢«æ‰§è¡Œä¸¤æ¬¡ï¼Œéçº¯å‡½æ•°ã€‚åœ¨è¿™é‡Œå°½é‡åªå¤„ç† state çš„çŠ¶æ€ã€‚



 useReducer çš„å®ç°ï¼š

```react
import { useState } from 'react';

function useReducer(reducer, initialState) {
    const [state, setState] = useState(initialState);

    function dispatch(action) {
        setState((s) => reducer(s, action));
    }

    return [state, dispatch];
}
```

ç›®å‰å·²æŒæ¡çš„ hooksï¼šuseStateï¼ŒuseReducer

 contextï¼šuseContextï¼ŒcreateContext



å¤§å†™å‘½å contextï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ…è£¹çš„ contextï¼Œå°±æ˜¯å–çš„é»˜è®¤å€¼ã€‚



ä¼˜å…ˆä½¿ç”¨ propsï¼Œä¸éœ€è¦è¿‡æ—©çš„ä¼˜åŒ–ã€‚



 å°† reducers å’Œ context ç»„åˆåœ¨ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ç®¡ç†å¤æ‚åº”ç”¨çš„çŠ¶æ€ã€‚ï¼ˆæŠ€å·§ï¼‰



 åˆ›å»º contextï¼š

```react
import { createContext } from 'react';

export const TasksContext = createContext(null);
export const TasksDispatchContext = createContext(null);
```

ç„¶åæŠŠ tasks å’Œ dispatch ä¼ å…¥å°±å¯ä»¥ï¼Œè¿›ä¸€æ­¥å°è£…ï¼š

```react
export function TasksProvider({ children }) {
  const [tasks, dispatch] = useReducer(tasksReducer, initialTasks);

  return (
    <TasksContext.Provider value={tasks}>
      <TasksDispatchContext.Provider value={dispatch}>
        {children}
      </TasksDispatchContext.Provider>
    </TasksContext.Provider>
  );
}
```

è¿˜å¯ä»¥å°†è·å–çš„é€»è¾‘ä¹Ÿå°è£…æˆå‡½æ•°

```react
export function useTasks() {
  return useContext(TasksContext);
}

export function useTasksDispatch() {
  return useContext(TasksDispatchContext);
}
```

ä¿æŒç»„ä»¶çš„å¹²å‡€å’Œæ•´æ´ï¼Œè®©æˆ‘ä»¬ä¸“æ³¨äºå®ƒä»¬æ˜¾ç¤ºçš„å†…å®¹ï¼Œè€Œä¸æ˜¯å®ƒä»¬ä»å“ªé‡Œè·å¾—æ•°æ®ã€‚

---

```react
import { createContext, useContext, useReducer } from 'react';

const TasksContext = createContext(null);

const TasksDispatchContext = createContext(null);

export function TasksProvider({ children }) {
  const [tasks, dispatch] = useReducer(
    tasksReducer,
    initialTasks
  );

  return (
    <TasksContext.Provider value={tasks}>
      <TasksDispatchContext.Provider value={dispatch}>
        {children}
      </TasksDispatchContext.Provider>
    </TasksContext.Provider>
  );
}

export function useTasks() {
  return useContext(TasksContext);
}

export function useTasksDispatch() {
  return useContext(TasksDispatchContext);
}

function tasksReducer(tasks, action) {
  switch (action.type) {
    case 'added': {
      return [...tasks, {
        id: action.id,
        text: action.text,
        done: false
      }];
    }
    case 'changed': {
      return tasks.map(t => {
        if (t.id === action.task.id) {
          return action.task;
        } else {
          return t;
        }
      });
    }
    case 'deleted': {
      return tasks.filter(t => t.id !== action.id);
    }
    default: {
      throw Error('Unknown action: ' + action.type);
    }
  }
}

const initialTasks = [
  { id: 0, text: 'Philosopherâ€™s Path', done: true },
  { id: 1, text: 'Visit the temple', done: false },
  { id: 2, text: 'Drink matcha', done: false }
];

```

---

[React åœ¨æ¸²æŸ“åˆ—è¡¨æ—¶ï¼Œåˆ—è¡¨å…ƒç´ çš„ Key é‡å¤äº†ä¼šæ€æ ·ï¼Ÿ](https://judes.me/frontend/2020/09/12/react-list-repeated-key.html)


 useRefï¼Œä¸ useState ä¸€æ ·ï¼Œåœ¨å¤šæ¬¡æ¸²æŸ“çš„æ—¶å€™æ•°æ®ä¼šè¿›è¡Œä¿ç•™ï¼Œä¸åŒçš„æ˜¯æ•°æ®å˜æ›´çš„æ—¶å€™ä¸ä¼šè§¦å‘æ¸²æŸ“ã€‚ä½¿ç”¨æ–¹å¼ä¸åŒï¼Œref ä¼šè¢«ä¿å­˜ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ï¼Œæ•°æ®ç»“æ„æ˜¯ {current: xxx}

```react
let ref = useRef(0);
ref.current = ref.current + 1;
```

useRef çš„å®ç°å¯ä»¥æ˜¯ä¸‹é¢è¿™æ ·ï¼š

```react
function useRef(initialValue) {
    const [ref, unused] = useState({ current: initialValue });
    return ref;
}
```

ref å°±æ˜¯ä¸ä¼šè§¦å‘æ¸²æŸ“çš„ stateã€‚

 ref è·å– DOMï¼Œä¸èƒ½æ˜¯è‡ªå®šä¹‰çš„ç»„ä»¶ã€‚

```react
import { useRef } from 'react';
const myRef = useRef(null);
<div ref={myRef}></div>
// ä½ å¯ä»¥ä½¿ç”¨ä»»æ„æµè§ˆå™¨ APIï¼Œä¾‹å¦‚ï¼š
myRef.current.scrollIntoView();
```

**Hook åªèƒ½åœ¨ç»„ä»¶çš„é¡¶å±‚è¢«è°ƒç”¨ã€‚ä¸èƒ½åœ¨å¾ªç¯è¯­å¥ã€æ¡ä»¶è¯­å¥æˆ– map() å‡½æ•°ä¸­è°ƒç”¨ useRef ã€‚**



 å°†å‡½æ•°ä¼ é€’ç»™ ref å±æ€§ã€‚è¿™ç§°ä¸º ref å›è°ƒã€‚é€šè¿‡å‡½æ•°å°† node èŠ‚ç‚¹ä¿å­˜åˆ°ä¸€ä¸ª map ç±»å‹çš„ref ä¸­

```react
{catList.map((cat) => (
    <li
        key={cat.id}
        ref={(node) => {
            const map = getMap();
            if (node) {
                map.set(cat.id, node);
            } else {
                map.delete(cat.id);
            }
        }}
    >
        <img src={cat.imageUrl} alt={'Cat #' + cat.id} />
    </li>
))}
```

æœ¬è´¨ä¸Šæ˜¯å°† dom é€šè¿‡ ref å±æ€§è¿›è¡ŒæŠ›å‡ºã€‚



 é»˜è®¤æƒ…å†µä¸‹ï¼ŒReact ä¸å…è®¸ç»„ä»¶è®¿é—®å…¶ä»–ç»„ä»¶çš„ DOM èŠ‚ç‚¹ã€‚ç”šè‡³è‡ªå·±çš„å­ç»„ä»¶ä¹Ÿä¸è¡Œï¼æ‰€ä»¥è‡ªå®šä¹‰ç»„ä»¶æ— æ³•é€šè¿‡ ref è·å–åˆ° DOMã€‚

---

ref æ²¡åŠæ³•ç›´æ¥é€šè¿‡è‡ªå®šä¹‰ç»„ä»¶çš„ ref å±æ€§ä¼ é€’ç»™å­ç»„ä»¶ï¼Œéœ€è¦é€šè¿‡ forwardRef æ–¹æ³•è¿›è¡Œä¼ é€’

```react
const MyInput = forwardRef((props, ref) => {
  return <input {...props} ref={ref} />;
});
```

useImperativeHandle å°†æŒ‡å®šçš„å¯¹è±¡ä½œä¸ºçˆ¶ç»„ä»¶çš„ ref å€¼ã€‚realInputRef æ˜¯çœŸæ­£ç»‘å®šçš„DOM èŠ‚ç‚¹ï¼š

```react
const MyInput = forwardRef((props, ref) => {
    const realInputRef = useRef(null);
    useImperativeHandle(ref, () => ({
        // åªæš´éœ² focusï¼Œæ²¡æœ‰åˆ«çš„
        focus() {
            realInputRef.current.focus();
        },
    }));
    return <input {...props} ref={realInputRef} />;
});
```

å¼ºåˆ¶ React åŒæ­¥æ›´æ–°ï¼ˆâ€œåˆ·æ–°â€ï¼‰DOMã€‚ ä¸ºæ­¤ï¼Œä» react-dom å¯¼å…¥ flushSync å¹¶å°† state æ›´æ–°åŒ…è£¹ åˆ° flushSync è°ƒç”¨ä¸­ï¼š

```react
flushSync(() => {
  setTodos([ ...todos, newTodo]);
});
```

é¿å…æ›´æ”¹ç”± React ç®¡ç†çš„ DOM èŠ‚ç‚¹ã€‚ å¯¹ React ç®¡ç†çš„å…ƒç´ è¿›è¡Œä¿®æ”¹ã€æ·»åŠ å­å…ƒç´ ã€ä»ä¸­åˆ é™¤å­å…ƒç´ ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„è§†è§‰ç»“æœã€‚

---

effectï¼Œç›‘å¬å™¨ï¼Œç±»ä¼¼äºVue çš„computedã€‚
 Effect åœ¨å±å¹•æ›´æ–°åçš„ æäº¤é˜¶æ®µ è¿è¡Œã€‚
 Effect é€šå¸¸ç”¨äºæš‚æ—¶â€œè·³å‡ºâ€ React ä»£ç å¹¶ä¸ä¸€äº› å¤–éƒ¨ ç³»ç»Ÿè¿›è¡ŒåŒæ­¥ã€‚
 é»˜è®¤æƒ…å†µä¸‹ï¼ŒEffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œã€‚æœ‰æ—¶ Effect éœ€è¦æŒ‡å®šå¦‚ä½•åœæ­¢ã€æ’¤é”€ï¼Œæˆ–è€…æ¸…é™¤å®ƒçš„æ•ˆæœã€‚

```react
function MyComponent() {
  useEffect(() => {
    // æ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œæ­¤å¤„çš„ä»£ç 
  });
  return <div />;
}
```

Effect é€šå¸¸åº”è¯¥ä½¿ç»„ä»¶ä¸ å¤–éƒ¨ ç³»ç»Ÿä¿æŒåŒæ­¥ã€‚å¦‚æœæ²¡æœ‰å¤–éƒ¨ç³»ç»Ÿï¼Œä½ åªæƒ³æ ¹æ®å…¶ä»–çŠ¶æ€è°ƒæ•´ä¸€äº›çŠ¶æ€ï¼Œé‚£ä¹ˆ ä½ ä¹Ÿè®¸ä¸éœ€è¦ Effectã€‚
 React ä½¿ç”¨ Object.is æ¯”è¾ƒä¾èµ–é¡¹çš„å€¼ã€‚

```react
useEffect(() => {
  // è¿™é‡Œçš„ä»£ç ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œ
});

useEffect(() => {
  // è¿™é‡Œçš„ä»£ç åªä¼šåœ¨ç»„ä»¶æŒ‚è½½åæ‰§è¡Œä¸€æ¬¡
}, []);

useEffect(() => {
  //è¿™é‡Œçš„ä»£ç åªä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åï¼Œå¹¶ä¸” a æˆ– b çš„å€¼ä¸ä¸Šæ¬¡æ¸²æŸ“ä¸ä¸€è‡´æ—¶æ‰§è¡Œ
}, [a, b]);
```

effect çš„å‚æ•°å‡½æ•°çš„è¿”å›å€¼æ˜¯æ¸…ç†å‡½æ•°ï¼Œåœ¨å¸è½½çš„æ—¶å€™ä¼šè¿›è¡Œè¿è¡Œï¼Œæ¸…ç†ä¸å¿…è¦çš„ä¸œè¥¿ã€‚åœ¨å¼€å‘ç¯å¢ƒ React ä¼šä¸»åŠ¨è°ƒç”¨ä¸¤æ¬¡ï¼Œç”¨æ¥è¿›è¡Œæ£€æŸ¥ã€‚
 ä¾‹å¦‚æŸäº› API å¯èƒ½ä¸å…è®¸è¿ç»­è°ƒç”¨ä¸¤æ¬¡ï¼Œå°±éœ€è¦å®ç°æ¸…ç†å‡½æ•°ã€‚

```react
useEffect(() => {
  const dialog = dialogRef.current;
  dialog.showModal();
  return () => dialog.close();
}, []);
```

è®¢é˜…äº‹ä»¶çš„æ¸…ç†ï¼š

```react
useEffect(() => {
  function handleScroll(e) {
    console.log(window.scrollX, window.scrollY);
  }
  window.addEventListener('scroll', handleScroll);
  return () => window.removeEventListener('scroll', handleScroll);
}, []);
```

é‡ç½®åŠ¨ç”»

```react
useEffect(() => {
  const node = ref.current;
  node.style.opacity = 1; // è§¦å‘åŠ¨ç”»
  return () => {
    node.style.opacity = 0; // é‡ç½®ä¸ºåˆå§‹å€¼
  };
}, []);
```

ä¸­æ­¢æ•°æ®è·å–æ“ä½œï¼šæ— æ³•æ’¤é”€å·²ç»å‘ç”Ÿçš„ç½‘ç»œè¯·æ±‚ã€‚

```react
useEffect(() => {
  let ignore = false;

  async function startFetching() {
    const json = await fetchTodos(userId);
    if (!ignore) {
      setTodos(json);
    }
  }

  startFetching();

  return () => {
    ignore = true;
  };
}, [userId]);
```

å¦‚æœå¼€å‘ç¯å¢ƒä¸­ï¼Œç¬¬äºŒæ¬¡è¯·æ±‚ç»™ä½ é€ æˆäº†å›°æ‰°ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ç§å¯ä»¥åˆ é™¤é‡å¤è¯·æ±‚ã€å¹¶ç¼“å­˜è¯·æ±‚å“åº”çš„è§£å†³æ–¹æ¡ˆï¼š

```react
function TodoList() {
  const todos = useSomeDataLibrary(`/api/user/${userId}/todos`);
  // ...
```

å°½é‡ä½¿ç”¨æ¡†æ¶ï¼Œå¦‚æœè‡ªå·±ç¼–å†™è¯·æ±‚æ–¹æ¡ˆï¼Œæ³¨æ„æ·»åŠ ç”¨äºåˆ é™¤é‡å¤è¯·æ±‚ã€ç¼“å­˜å“åº”å’Œé¿å…ç½‘ç»œç€‘å¸ƒï¼ˆé€šè¿‡é¢„åŠ è½½æ•°æ®æˆ–å°†æ•°æ®éœ€æ±‚æå‡åˆ°è·¯ç”±ï¼‰çš„é€»è¾‘ã€‚



 ç›®å‰å—æ¬¢è¿çš„å¼€æºè§£å†³æ–¹æ¡ˆæ˜¯ React Queryã€useSWR å’Œ React Router v6.4+ã€‚



 æ—¥å¿—ç±»çš„ä¸ŠæŠ¥å¯ä»¥ä¸ç”¨è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥æš‚æ—¶å–æ¶ˆä¸¥æ ¼æ¨¡å¼ï¼Œåœ¨å¼€å‘ç¯å¢ƒè¿›è¡ŒåŠ è½½æ£€æŸ¥ã€‚è¿˜å¯ä»¥è€ƒè™‘æ¢æˆè·¯ç”±å˜æ›´äº‹ä»¶å¤„ç†ç¨‹åºä¸­å‘é€åˆ†ææ•°æ®ã€‚



 æŸäº›é€»è¾‘åº”è¯¥åªåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¿è¡Œä¸€æ¬¡ã€‚æ¯”å¦‚ï¼ŒéªŒè¯ç™»é™†çŠ¶æ€å’ŒåŠ è½½æœ¬åœ°ç¨‹åºæ•°æ®ã€‚ä½ å¯ä»¥å°†å…¶æ”¾åœ¨ç»„ä»¶ä¹‹å¤–ï¼š

```react
if (typeof window !== 'undefined') { // æ£€æŸ¥æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ
  checkAuthToken();
  loadDataFromLocalStorage();
}

function App() {
  // â€¦â€¦
}
```

å…¶ä»–æƒ…å†µï¼šâ€œè´­ä¹°â€çš„æ“ä½œä¸åº”ç”±ç»„ä»¶çš„æŒ‚è½½ã€æ¸²æŸ“å¼•èµ·çš„ï¼›å®ƒæ˜¯ç”±ç‰¹å®šçš„äº¤äº’ä½œç”¨å¼•èµ·çš„ï¼Œå®ƒåº”è¯¥åªåœ¨ç”¨æˆ·æŒ‰ä¸‹æŒ‰é’®æ—¶è¿è¡Œã€‚å› æ­¤ï¼Œå®ƒä¸åº”è¯¥å†™åœ¨ Effect ä¸­ï¼Œåº”å½“æŠŠ /api/buy è¯·æ±‚æ“ä½œç§»åŠ¨åˆ°è´­ä¹°æŒ‰é’®äº‹ä»¶å¤„ç†ç¨‹åºä¸­.



 React æ€»æ˜¯åœ¨æ‰§è¡Œä¸‹ä¸€è½®æ¸²æŸ“çš„ Effect ä¹‹å‰æ¸…ç†ä¸Šä¸€è½®æ¸²æŸ“çš„ Effectã€‚



 æ¯ä¸€è½®æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„ Effectã€‚



 ä½¿ç”¨æ˜¾å¼æ ‡è®°ï¼Œå¦‚ ignore å˜é‡ï¼Œæ˜¯ä¿®å¤æ¡ä»¶ç«äº‰æœ€å¯é çš„æ–¹æ³•ã€‚

---

å¦‚æœæ²¡æœ‰æ¶‰åŠåˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œéœ€è¦æ ¹æ®ä¸€äº› props æˆ– state çš„å˜åŒ–æ¥æ›´æ–°ä¸€ä¸ªç»„ä»¶çš„ stateï¼‰ï¼Œä¸åº”è¯¥ä½¿ç”¨ Effectã€‚ç§»é™¤ä¸å¿…è¦çš„ Effect å¯ä»¥è®©ä»£ç æ›´å®¹æ˜“ç†è§£ï¼Œè¿è¡Œå¾—æ›´å¿«ï¼Œå¹¶ä¸”æ›´å°‘å‡ºé”™ã€‚

 åœ¨æ¸²æŸ“æ—¶è¿›è¡Œå°½å¯èƒ½å¤šåœ°è®¡ç®—ã€‚

 å¦‚æœä¸€ä¸ªå€¼å¯ä»¥åŸºäºç°æœ‰çš„ props æˆ– state è®¡ç®—å¾—å‡ºï¼Œä¸è¦æŠŠå®ƒä½œä¸ºä¸€ä¸ª stateï¼Œè€Œæ˜¯åœ¨æ¸²æŸ“æœŸé—´ç›´æ¥è®¡ç®—è¿™ä¸ªå€¼ã€‚è¿™å°†ä½¿ä½ çš„ä»£ç æ›´å¿«ï¼ˆé¿å…äº†å¤šä½™çš„ â€œçº§è”â€ æ›´æ–°ï¼‰ã€æ›´ç®€æ´ï¼ˆç§»é™¤äº†ä¸€äº›ä»£ç ï¼‰ä»¥åŠæ›´å°‘å‡ºé”™ï¼ˆé¿å…äº†ä¸€äº›å› ä¸ºä¸åŒçš„ state å˜é‡ä¹‹é—´æ²¡æœ‰æ­£ç¡®åŒæ­¥è€Œå¯¼è‡´çš„é—®é¢˜ï¼‰ã€‚

 è®¡ç®—ä¹‹åï¼Œè¿›è¡Œæ¸²æŸ“ï¼Œç„¶åæ‰§è¡Œ effectï¼Œå¦‚æœ effect ä¸­è¿›è¡Œäº†æ•°æ®ä¿®æ”¹ï¼Œé‚£ä¹ˆä¼šé‡æ–°è¿›è¡Œæ¸²æŸ“ã€‚

 effect ç±»ä¼¼äº watchï¼Œï¼ŒuseMemo ç±»ä¼¼äº computedï¼Œè¿›è¡Œç¼“å­˜ã€‚
 ä¼ å…¥ useMemo çš„å‡½æ•°ä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œï¼Œä»…é€‚ç”¨äºçº¯å‡½æ•°åœºæ™¯ã€‚

 å½“ä½ å†³å®šå°†æŸäº›é€»è¾‘æ”¾å…¥äº‹ä»¶å¤„ç†å‡½æ•°è¿˜æ˜¯ Effect ä¸­æ—¶ï¼Œä½ éœ€è¦å›ç­”çš„ä¸»è¦é—®é¢˜æ˜¯ï¼šä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹å®ƒæ˜¯ æ€æ ·çš„é€»è¾‘ã€‚å¦‚æœè¿™ä¸ªé€»è¾‘æ˜¯ç”±æŸä¸ªç‰¹å®šçš„äº¤äº’å¼•èµ·çš„ï¼Œè¯·å°†å®ƒä¿ç•™åœ¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ã€‚å¦‚æœæ˜¯ç”±ç”¨æˆ·åœ¨å±å¹•ä¸Š çœ‹åˆ° ç»„ä»¶æ—¶å¼•èµ·çš„ï¼Œè¯·å°†å®ƒä¿ç•™åœ¨ Effect ä¸­ã€‚
 **é‡ç½®æ•°æ®**
 éœ€è¦é‡ç½®æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœç”¨ effect è¿›è¡Œå¤„ç†ï¼Œæ¯”è¾ƒä½æ•ˆã€‚æ¯”è¾ƒå¥½çš„åšæ³•æ˜¯æå–æˆç»„ä»¶ï¼Œç»™ä¸€ä¸ªkeyå€¼ï¼Œå½“keyå€¼å˜åŒ–çš„æ—¶å€™ï¼Œreact ä¼šé‡æ–°æ¸²æŸ“æ–°ç»„ä»¶ï¼Œä»è€Œé‡ç½®æ•°æ®çŠ¶æ€ã€‚
 **é‡ç½®éƒ¨åˆ†æ•°æ®**

```react
function List({ items }) {
  const [isReverse, setIsReverse] = useState(false);
  const [selection, setSelection] = useState(null);

  // å¥½ä¸€äº›ï¼šåœ¨æ¸²æŸ“æœŸé—´è°ƒæ•´ state
  const [prevItems, setPrevItems] = useState(items);
  if (items !== prevItems) {
    setPrevItems(items);
    setSelection(null);
  }
  // ...
}
```

[å­˜å‚¨å‰æ¬¡æ¸²æŸ“ä¿¡æ¯](https://react.docschina.org/reference/react/useState#storing-information-from-previous-renders)

 ä»»ä½•å…¶ä»–å‰¯ä½œç”¨ï¼ˆæ¯”å¦‚å˜åŒ– DOM æˆ–è®¾ç½®çš„å»¶æ—¶ï¼‰åº”è¯¥ç•™åœ¨äº‹ä»¶å¤„ç†å‡½æ•°æˆ– Effect ä¸­ï¼Œä»¥ ä¿æŒç»„ä»¶çº¯ç²¹ã€‚

 æ— è®ºä½ æ€ä¹ˆåšï¼Œæ ¹æ® props æˆ–å…¶ä»– state æ¥è°ƒæ•´ state éƒ½ä¼šä½¿æ•°æ®æµæ›´éš¾ç†è§£å’Œè°ƒè¯•ã€‚æ€»æ˜¯æ£€æŸ¥æ˜¯å¦å¯ä»¥é€šè¿‡æ·»åŠ  key æ¥é‡ç½®æ‰€æœ‰ stateï¼Œæˆ–è€… åœ¨æ¸²æŸ“æœŸé—´è®¡ç®—æ‰€éœ€å†…å®¹ã€‚

 å½“ä½ ä¸ç¡®å®šæŸäº›ä»£ç åº”è¯¥æ”¾åœ¨ Effect ä¸­è¿˜æ˜¯äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æ—¶ï¼Œå…ˆè‡ªé—® ä¸ºä»€ä¹ˆ è¦æ‰§è¡Œè¿™äº›ä»£ç ã€‚Effect åªç”¨åœ¨æ‰§è¡Œé‚£äº›æŒ‚è½½ç»„ä»¶æ—¶ éœ€è¦æ‰§è¡Œ çš„ä»£ç ã€‚å¦‚æœæ˜¯åœ¨äº‹ä»¶å¤„ç†åæ‰§è¡Œçš„ä»£ç ï¼Œåˆ™ç”¨äº‹ä»¶å¤„ç†å‡½æ•°å¤„ç†ã€‚

 å¦‚æœæŸäº›é€»è¾‘å¿…é¡»åœ¨ æ¯æ¬¡åº”ç”¨åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œè€Œä¸æ˜¯åœ¨ æ¯æ¬¡ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªé¡¶å±‚å˜é‡æ¥è®°å½•å®ƒæ˜¯å¦å·²ç»æ‰§è¡Œè¿‡äº†ï¼š

```react
let didInit = false;

function App() {
  useEffect(() => {
    if (!didInit) {
      didInit = true;
      // âœ… åªåœ¨æ¯æ¬¡åº”ç”¨åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡
      loadDataFromLocalStorage();
      checkAuthToken();
    }
  }, []);
  // ...
}
```

æ¯å½“ä½ å°è¯•ä¿æŒä¸¤ä¸ªä¸åŒçš„ state å˜é‡ä¹‹é—´çš„åŒæ­¥æ—¶ï¼Œè¯•è¯•çŠ¶æ€æå‡ï¼

 ä¿æŒæ•°æ®æµçš„å¯é¢„æµ‹æ€§ï¼šæ•°æ®ä»çˆ¶ç»„ä»¶æµå‘å­ç»„ä»¶ã€‚

 å°½ç®¡é€šå¸¸å¯ä»¥ä½¿ç”¨ Effect æ¥å®ç°æ­¤åŠŸèƒ½ï¼Œä½† React ä¸ºæ­¤é’ˆå¯¹æ€§åœ°æä¾›äº†ä¸€ä¸ª Hook ç”¨äºè®¢é˜…å¤–éƒ¨ storeã€‚åˆ é™¤ Effect å¹¶å°†å…¶æ›¿æ¢ä¸ºè°ƒç”¨ useSyncExternalStoreï¼š
```react
function subscribe(callback) {
  window.addEventListener('online', callback);
  window.addEventListener('offline', callback);
  return () => {
    window.removeEventListener('online', callback);
    window.removeEventListener('offline', callback);
  };
}

function useOnlineStatus() {
  // âœ… éå¸¸å¥½ï¼šç”¨å†…ç½®çš„ Hook è®¢é˜…å¤–éƒ¨ store
  return useSyncExternalStore(
    subscribe, // åªè¦ä¼ é€’çš„æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼ŒReact ä¸ä¼šé‡æ–°è®¢é˜…
    () => navigator.onLine, // å¦‚ä½•åœ¨å®¢æˆ·ç«¯è·å–å€¼
    () => true // å¦‚ä½•åœ¨æœåŠ¡ç«¯è·å–å€¼
  );
}

function ChatIndicator() {
  const isOnline = useOnlineStatus();
  // ...
}
```

[useSyncExternalStore](https://react.docschina.org/reference/react/useSyncExternalStore)

 å¤„ç†ç«æ€æ¡ä»¶å¹¶ä¸æ˜¯å®ç°æ•°æ®è·å–çš„å”¯ä¸€éš¾ç‚¹ã€‚ä½ å¯èƒ½è¿˜éœ€è¦è€ƒè™‘ç¼“å­˜å“åº”ç»“æœï¼ˆä½¿ç”¨æˆ·ç‚¹å‡»åé€€æŒ‰é’®æ—¶å¯ä»¥ç«‹å³çœ‹åˆ°å…ˆå‰çš„å±å¹•å†…å®¹ï¼‰ï¼Œå¦‚ä½•åœ¨æœåŠ¡ç«¯è·å–æ•°æ®ï¼ˆä½¿æœåŠ¡ç«¯åˆå§‹æ¸²æŸ“çš„ HTML ä¸­åŒ…å«è·å–åˆ°çš„å†…å®¹è€Œä¸æ˜¯åŠ è½½åŠ¨ç”»ï¼‰ï¼Œä»¥åŠå¦‚ä½•é¿å…ç½‘ç»œç€‘å¸ƒï¼ˆä½¿å­ç»„ä»¶ä¸å¿…ç­‰å¾…æ¯ä¸ªçˆ¶ç»„ä»¶çš„æ•°æ®è·å–å®Œæ¯•åæ‰å¼€å§‹è·å–æ•°æ®ï¼‰ã€‚

 è·å–æ•°æ®ï¼Œå°†è·å–é€»è¾‘æå–åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ Hook ä¸­ï¼š

```react
function SearchResults({ query }) {
  const [page, setPage] = useState(1);
  const params = new URLSearchParams({ query, page });
  const results = useData(`/api/search?${params}`);

  function handleNextPageClick() {
    setPage(page + 1);
  }
  // ...
}

function useData(url) {
  const [data, setData] = useState(null);
  useEffect(() => {
    let ignore = false;
    fetch(url)
      .then(response => response.json())
      .then(json => {
        if (!ignore) {
          setData(json);
        }
      });
    return () => {
      ignore = true;
    };
  }, [url]);
  return data;
}
```

æ‘˜è¦ï¼š

- å¦‚æœä½ å¯ä»¥åœ¨æ¸²æŸ“æœŸé—´è®¡ç®—æŸäº›å†…å®¹ï¼Œåˆ™ä¸éœ€è¦ä½¿ç”¨ Effectã€‚

- æƒ³è¦ç¼“å­˜æ˜‚è´µçš„è®¡ç®—ï¼Œè¯·ä½¿ç”¨ useMemo è€Œä¸æ˜¯ useEffectã€‚

- æƒ³è¦é‡ç½®æ•´ä¸ªç»„ä»¶æ ‘çš„ stateï¼Œè¯·ä¼ å…¥ä¸åŒçš„ keyã€‚

- æƒ³è¦åœ¨ prop å˜åŒ–æ—¶é‡ç½®æŸäº›ç‰¹å®šçš„ stateï¼Œè¯·åœ¨æ¸²æŸ“æœŸé—´å¤„ç†ã€‚

- ç»„ä»¶ æ˜¾ç¤º æ—¶å°±éœ€è¦æ‰§è¡Œçš„ä»£ç åº”è¯¥æ”¾åœ¨ Effect ä¸­ï¼Œå¦åˆ™åº”è¯¥æ”¾åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ã€‚

- å¦‚æœä½ éœ€è¦æ›´æ–°å¤šä¸ªç»„ä»¶çš„ stateï¼Œæœ€å¥½åœ¨å•ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¤„ç†ã€‚

- å½“ä½ å°è¯•åœ¨ä¸åŒç»„ä»¶ä¸­åŒæ­¥ state å˜é‡æ—¶ï¼Œè¯·è€ƒè™‘çŠ¶æ€æå‡ã€‚

- ä½ å¯ä»¥ä½¿ç”¨ Effect è·å–æ•°æ®ï¼Œä½†ä½ éœ€è¦å®ç°æ¸…é™¤é€»è¾‘ä»¥é¿å…ç«æ€æ¡ä»¶ã€‚

  

 Effect çš„ç”Ÿå‘½å‘¨æœŸä¸åŒäºç»„ä»¶ã€‚ç»„ä»¶å¯ä»¥æŒ‚è½½ã€æ›´æ–°æˆ–å¸è½½ã€‚Effect åªèƒ½åšä¸¤ä»¶äº‹ï¼šå¼€å§‹åŒæ­¥æŸäº›ä¸œè¥¿ï¼Œç„¶ååœæ­¢åŒæ­¥å®ƒã€‚å¦‚æœ Effect ä¾èµ–äºéšæ—¶é—´å˜åŒ–çš„ props å’Œ stateï¼Œè¿™ä¸ªå¾ªç¯å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡ã€‚



 ä»£ç ä¸­çš„æ¯ä¸ª Effect åº”è¯¥ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹ã€‚.åˆ é™¤ä¸€ä¸ª Effect ä¸ä¼šå½±å“å¦ä¸€ä¸ª Effect çš„é€»è¾‘ã€‚è¿™è¡¨æ˜å®ƒä»¬åŒæ­¥ä¸åŒçš„å†…å®¹ï¼Œå› æ­¤å°†å®ƒä»¬æ‹†åˆ†å¼€æ˜¯æœ‰æ„ä¹‰çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå°†ä¸€ä¸ªå†…èšçš„é€»è¾‘æ‹†åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„ Effectsï¼Œä»£ç å¯èƒ½ä¼šçœ‹èµ·æ¥æ›´åŠ â€œæ¸…æ™°â€ï¼Œä½† ç»´æŠ¤èµ·æ¥ä¼šæ›´åŠ å›°éš¾ã€‚

---

prop ä¸ stateï¼Œä»¥åŠä¾èµ–å®ƒä»¬è®¡ç®—å¾—åˆ°çš„å€¼ï¼Œéƒ½æ˜¯å“åº”å¼çš„ã€‚

 Effect ä¾èµ–é¡¹å¿…é¡»åŒ…æ‹¬ Effect ä¸­è¯»å–çš„æ¯ä¸ª å“åº”å¼å€¼ã€‚å¦‚æœæœ‰éƒ¨åˆ† state æ˜¯ä¸æƒ³è¢«ä¾èµ–çš„è¯ï¼Œåº”è¯¥æå–åˆ° useEffectEvent äº‹ä»¶ä¸­ã€‚

 ç†æƒ³æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºä¸­çš„å¤§å¤šæ•° Effect æœ€ç»ˆéƒ½åº”è¯¥ç”±è‡ªå®šä¹‰ Hook æ›¿ä»£ï¼Œæ— è®ºæ˜¯ç”±ä½ è‡ªå·±ç¼–å†™è¿˜æ˜¯ç”±ç¤¾åŒºæä¾›ã€‚è‡ªå®šä¹‰ Hook éšè—äº†åŒæ­¥é€»è¾‘ï¼Œå› æ­¤è°ƒç”¨ç»„ä»¶ä¸çŸ¥é“ Effect çš„å­˜åœ¨ã€‚éšç€ä½ ç»§ç»­å¼€å‘åº”ç”¨ç¨‹åºï¼Œä½ å°†å¼€å‘å‡ºä¸€å¥—å¯ä¾›é€‰æ‹©çš„ Hooksï¼Œå¹¶ä¸”æœ€ç»ˆå°†ä¸å†ç»å¸¸åœ¨ç»„ä»¶ä¸­ç¼–å†™ Effectã€‚

 **useEffectEvent**(å®éªŒä¸­çš„åŠŸèƒ½)
 Effect è¯»å–çš„æ¯ä¸€ä¸ªå“åº”å¼å€¼éƒ½å¿…é¡»åœ¨å…¶ä¾èµ–é¡¹ä¸­å£°æ˜ã€‚
 æš‚æ—¶ä½¿ç”¨ä¸‹é¢è¿™ä¸ªè¿›è¡Œä¾èµ–é¡¹æŠ‘åˆ¶ï¼š

```react
 // eslint-disable-next-line react-hooks/exhaustive-deps
```

---

**ç§»é™¤ effect ä¾èµ–ã€‚**
 ä¸æ˜¯å“åº”å¼å€¼ï¼ˆå¹¶ä¸”ä¸èƒ½åœ¨é‡æ–°æ¸²æŸ“æ—¶æ”¹å˜ï¼‰ï¼Œé‚£å®ƒä¸å°±ä¸æ˜¯ä¾èµ–ã€‚ä¸€ä¸ªæ•°æ®è¦æ¸…æ¥šå®ƒä»€ä¹ˆæ—¶å€™ä¼šè¢«æ”¹å˜ã€‚

 æŠŠä¾èµ–çœ‹ä½œæ˜¯ Effectçš„ä»£ç æ‰€ä¾èµ–çš„æ‰€æœ‰å“åº”å¼å€¼çš„åˆ—è¡¨ã€‚ä½ ä¸è¦ é€‰æ‹© æŠŠä»€ä¹ˆæ”¾åœ¨è¿™ä¸ªåˆ—è¡¨ä¸Šã€‚è¯¥åˆ—è¡¨ æè¿°äº† ä»£ç ã€‚è¦æ”¹å˜ä¾èµ–ï¼Œè¯·æ”¹å˜ä»£ç ã€‚

 \- ä½ åº”è¯¥è€ƒè™‘çš„ç¬¬ä¸€ä»¶äº‹æ˜¯ï¼Œè¿™æ®µä»£ç æ˜¯å¦åº”è¯¥æˆä¸º Effectã€‚
 \- ä¸‹ä¸€ä¸ªåº”è¯¥é—®è‡ªå·±çš„é—®é¢˜æ˜¯ï¼ŒEffect æ˜¯å¦åœ¨åšå‡ ä»¶ä¸ç›¸å…³çš„äº‹æƒ…ã€‚

 Effect çš„ä¾èµ–é¡¹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ˜¯å¦æ˜¯å¯¹è±¡ï¼ˆEffect ä½¿ç”¨ Object.is è¿›è¡Œåˆ¤æ–­ï¼‰å¹¶ä¸”æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œè¿™ä¼šå¯¼è‡´ Effect é‡æ–°æ‰§è¡Œã€‚å¦‚æœæ˜¯é™æ€å€¼ï¼Œå¯ä»¥è€ƒè™‘ç§»å‡ºç»„ä»¶ï¼Œæˆ–è€…åœ¨Effect é‡Œé¢åˆ›å»ºã€‚å‡½æ•°ä¹ŸåŒæ ·é€‚ç”¨ã€‚

 å¦‚æœæ˜¯ props ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œå¯¹è±¡æˆ–è€…å‡½æ•°ï¼Œå¦‚æœä½œä¸º effect çš„ä¾èµ–ï¼Œå¯èƒ½æ¯æ¬¡çˆ¶ç»„ä»¶æ¸²æŸ“çš„æ—¶å€™ä¼šå¯¼è‡´å­ç»„ä»¶çš„ effect é‡æ–°æ‰§è¡Œï¼Œæ¯”è¾ƒå¥½çš„æ–¹æ¡ˆæ˜¯åœ¨ effect å¤–è¿›è¡Œå¯¹è±¡å±æ€§çš„è·å–ï¼Œç„¶åå†ä¼ é€’ç»™ effectã€‚

 å¦‚æœæ˜¯å‡½æ•°ï¼Œä¹Ÿæ˜¯åœ¨ effect å¤–è¿›è¡Œæ‰§è¡Œè·å–è¿”å›å€¼ï¼Œå†ä½œä¸º effect ä¾èµ–ã€‚å¦‚æœä¸è¡Œå¹¶ä¸”æ˜¯äº‹ä»¶å¤„ç†ç¨‹åºï¼Œé‚£å°±ç”¨ effect event è¿›è¡ŒåŒ…è£…ã€‚

 å¦‚æœä¸éœ€è¦ä¼ å‚ï¼Œè€ƒè™‘ setState å‡½æ•°æ˜¯å¦å¯ä»¥ç”¨å›è°ƒå‡½æ•°ï¼Œå°†ä¸Šä¸€ä¸ªstateè¿›è¡Œè‡ªå¢æˆ–è€…è‡ªå‡è¿™ç§ï¼Œå°±å¯ä»¥é¿å…è¢« linter è¿›è¡Œä¾èµ–æ£€æµ‹ã€‚

 **å‘ç° react çš„ linter æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸œè¥¿ï¼Œèƒ½å¤Ÿæç¤ºå¹¶ä¸”é¿å…å¾ˆå¤šé—®é¢˜ã€‚**

 **ä½¿ç”¨è‡ªå®šä¹‰ Hook å¤ç”¨é€»è¾‘**
 React ç»„ä»¶åç§°å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚
 Hook çš„åç§°å¿…é¡»æ°¸è¿œä»¥ use å¼€å¤´ï¼Œç„¶åç´§è·Ÿä¸€ä¸ªå¤§å†™å­—æ¯ã€‚

 è‡ªå®šä¹‰ Hook å…±äº«çš„æ˜¯çŠ¶æ€é€»è¾‘ï¼Œè€Œä¸æ˜¯çŠ¶æ€æœ¬èº«ã€‚åªæ˜¯å¤ç”¨ä»£ç é€»è¾‘ï¼ŒçŠ¶æ€æœ¬èº«æ˜¯ç‹¬ç«‹çš„ã€‚

 æ¯å½“ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œè‡ªå®šä¹‰ Hook ä¸­çš„ä»£ç å°±ä¼šé‡æ–°è¿è¡Œã€‚è¿™å°±æ˜¯ç»„ä»¶å’Œè‡ªå®šä¹‰ Hook éƒ½ éœ€è¦æ˜¯çº¯å‡½æ•° çš„åŸå› ã€‚æˆ‘ä»¬åº”è¯¥æŠŠè‡ªå®šä¹‰ Hook çš„ä»£ç çœ‹ä½œç»„ä»¶ä¸»ä½“çš„ä¸€éƒ¨åˆ†ã€‚

 å¢åŠ å¯¹ onReceiveMessage çš„ä¾èµ–å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºæ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶èŠå¤©å®¤å°±ä¼šé‡æ–°è¿æ¥ã€‚ é€šè¿‡ å°†è¿™ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°åŒ…è£¹åˆ° Effect Event ä¸­æ¥å°†å®ƒä»ä¾èµ–ä¸­ç§»é™¤ï¼š

```react
import { useEffect, useEffectEvent } from 'react';
// ...

export function useChatRoom({ serverUrl, roomId, onReceiveMessage }) {
  const onMessage = useEffectEvent(onReceiveMessage);

  useEffect(() => {
    const options = {
      serverUrl: serverUrl,
      roomId: roomId
    };
    const connection = createConnection(options);
    connection.connect();
    connection.on('message', (msg) => {
      onMessage(msg);
    });
    return () => connection.disconnect();
  }, [roomId, serverUrl]); // âœ… å£°æ˜æ‰€æœ‰ä¾èµ–
}
```

æ¯å½“ä½ å†™ Effect æ—¶ï¼Œè€ƒè™‘ä¸€ä¸‹æŠŠå®ƒåŒ…è£¹åœ¨è‡ªå®šä¹‰ Hook æ˜¯å¦æ›´æ¸…æ™°ã€‚ä½ ä¸åº”è¯¥ç»å¸¸ä½¿ç”¨ Effectï¼Œæ‰€ä»¥å¦‚æœä½ æ­£åœ¨å†™ Effect å°±æ„å‘³ç€ä½ éœ€è¦â€œèµ°å‡º Reactâ€å’ŒæŸäº›å¤–éƒ¨ç³»ç»ŸåŒæ­¥ï¼Œæˆ–è€…éœ€è¦åšä¸€äº› React ä¸­æ²¡æœ‰å¯¹åº”å†…ç½® API çš„äº‹ã€‚æŠŠ Effect åŒ…è£¹è¿›è‡ªå®šä¹‰ Hook å¯ä»¥å‡†ç¡®è¡¨è¾¾ä½ çš„ç›®æ ‡ä»¥åŠæ•°æ®åœ¨é‡Œé¢æ˜¯å¦‚ä½•æµåŠ¨çš„ã€‚

 ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ çš„è‡ªå®šä¹‰ Hook åç§°åº”è¯¥æ¸…æ™°åˆ°å³ä½¿ä¸€ä¸ªä¸ç»å¸¸å†™ä»£ç çš„äººä¹Ÿèƒ½å¾ˆå¥½åœ°çŒœä¸­è‡ªå®šä¹‰ Hook çš„åŠŸèƒ½ï¼Œè¾“å…¥å’Œè¿”å›ï¼š

 âœ… useData(url)
 âœ… useImpressionLog(eventName, extraData)
 âœ… useChatRoom(options)
 å½“ä½ å’Œå¤–éƒ¨ç³»ç»ŸåŒæ­¥çš„æ—¶å€™ï¼Œä½ çš„è‡ªå®šä¹‰ Hook åç§°å¯èƒ½ä¼šæ›´åŠ ä¸“ä¸šï¼Œå¹¶ä½¿ç”¨è¯¥ç³»ç»Ÿç‰¹å®šçš„æœ¯è¯­ã€‚åªè¦å¯¹ç†Ÿæ‚‰è¿™ä¸ªç³»ç»Ÿçš„äººæ¥è¯´åç§°æ¸…æ™°å°±å¯ä»¥ï¼š

 âœ… useMediaQuery(query)
 âœ… useSocket(url)
 âœ… useIntersectionObserver(ref, options)

 å¥½çš„è‡ªå®šä¹‰ Hook é€šè¿‡é™åˆ¶åŠŸèƒ½ä½¿ä»£ç è°ƒç”¨æ›´å…·å£°æ˜æ€§ã€‚ä¾‹å¦‚ useChatRoom(options) åªèƒ½è¿æ¥èŠå¤©å®¤ï¼Œè€Œ useImpressionLog(eventName, extraData) åªèƒ½å‘åˆ†æç³»ç»Ÿå‘é€å±•ç¤ºæ—¥å¿—ã€‚å¦‚æœä½ çš„è‡ªå®šä¹‰ Hook API æ²¡æœ‰çº¦æŸç”¨ä¾‹ä¸”éå¸¸æŠ½è±¡ï¼Œé‚£ä¹ˆåœ¨é•¿æœŸçš„è¿è¡Œä¸­ï¼Œå®ƒå¼•å…¥çš„é—®é¢˜å¯èƒ½æ¯”è§£å†³çš„é—®é¢˜æ›´å¤šã€‚

 æŠŠ Effect åŒ…è£¹è¿›è‡ªå®šä¹‰ Hook æœ‰ç›Šçš„å¦ä¸€ä¸ªåŸå› ï¼š
 \- ä½ è®©è¿›å‡º Effect çš„æ•°æ®æµéå¸¸æ¸…æ™°ã€‚
 \- ä½ è®©ç»„ä»¶ä¸“æ³¨äºç›®æ ‡ï¼Œè€Œä¸æ˜¯ Effect çš„å‡†ç¡®å®ç°ã€‚
 \- å½“ React å¢åŠ æ–°ç‰¹æ€§æ—¶ï¼Œä½ å¯ä»¥åœ¨ä¸ä¿®æ”¹ä»»ä½•ç»„ä»¶çš„æƒ…å†µä¸‹ç§»é™¤è¿™äº› Effectã€‚

---

ä½¿ç”¨æµè§ˆå™¨çš„ requestAnimationFrame API ä»å¤´å¼€å§‹ å®ç°ä¸€ä¸ª fade-in åŠ¨ç”»ã€‚

```react
import { useState, useEffect, useRef } from 'react';

function Welcome() {
  const ref = useRef(null);

  useEffect(() => {
    const duration = 1000;
    const node = ref.current;

    let startTime = performance.now();
    let frameId = null;

    function onFrame(now) {
      const timePassed = now - startTime;
      const progress = Math.min(timePassed / duration, 1);
      onProgress(progress);
      if (progress < 1) {
        // æˆ‘ä»¬è¿˜æœ‰æ›´å¤šçš„å¸§éœ€è¦ç»˜åˆ¶
        frameId = requestAnimationFrame(onFrame);
      }
    }

    function onProgress(progress) {
      node.style.opacity = progress;
    }

    function start() {
      onProgress(0);
      startTime = performance.now();
      frameId = requestAnimationFrame(onFrame);
    }

    function stop() {
      cancelAnimationFrame(frameId);
      startTime = null;
      frameId = null;
    }

    start();
    return () => stop();
  }, []);

  return (
    <h1 className="welcome" ref={ref}>
      Welcome
    </h1>
  );
}
```

